<!DOCTYPE html> 
<html>
	<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1"> 
	<title>Tapestry5 Portlet - Portlet Communication</title> 
	<link rel="stylesheet"  href="../../css/themes/default/jquery.mobile-1.2.0.css" /> 
	<link rel="stylesheet" href="../_assets/css/jqm-docs.css"/>

	<script src="../../js/jquery.js"></script>
	<script src="../../docs/_assets/js/jqm-docs.js"></script>
	<script src="../../js/jquery.mobile-1.2.0.js"></script>

</head> 
<body> 

<div data-role="page" class="type-interior">

	<div data-role="header" data-theme="f">
		<h1>Portlet Communication</h1>
		<a href="../../" data-icon="home" data-iconpos="notext" data-direction="reverse">Home</a>
		<a href="../nav.html" data-icon="search" data-iconpos="notext" data-rel="dialog" data-transition="fade">Search</a>
	</div><!-- /header -->

	<div data-role="content">
		
	<h2>Communicate with Render Parameters</h2>
		
	<p>This is probably the easiest way to share information between portlets. 
	According to JSR 168, after each action request there will be a render request. 
	Portlet can declare public render parameter during action phase 
	that will be passed by the container during the render request. </p>

	<p>If you want your portlet to use render parameter, you have to Configure your portlet to accept render parameters.
	this is done by using the "supported-public-render-parameter" element in the portlet 
	definition and by providing public render parameter supported by the application
	</p> 
		
<textarea readonly="readonly">
<portlet>
  <portlet-name>TapestryPortlet</portlet-name>
    <supported-public-render-parameter> PublicParam </supported-public-render-parameter>
      ...
</portlet>      
...
<public-render-parameter>
  <identifier>PublicParam</identifier>
  <qname xmlns:x="http://www.liferay.com/public-render-parameters">x:publicParam</qname>
</public-render-parameter></textarea> 

	<p>By default for non ajax event, the bridge generate a action url for each event handler. 
	So the following code demonstrate how to generate a render link and how to add parameter to it.<p/>
	
<textarea readonly="readonly">
@OnEvent(value = EventConstants.ACTION, component = "actionLink")
public Link clickLink() {
       Link result = linkSource.createPageRenderLink(resources.getPageName(), false);
       result.addParameter(Constants.PUBLIC_PARAM, publicParam);
       return result;
}
</textarea>

	<p>The Constants.PUBLIC_PARAM parameter will be appended to the following render request. 
	The container will automatically discover which parameter is public or not from the portlet descriptor files.<p/>
       
       
       <h2>Communicate with Events</h2>
       
       <p>JSR 286 Introduced the concept of portlet events to allow loosely coupled communication between portlets. 
	In order to be allowed to send an event to other portlet, a portlet must first define this event in portlet.xml<p/>
 		    
<textarea readonly="readonly">
<portlet-app>
...
 <event-definition>
  <name>sampleEvent</name>
  <value-type>java.lang.String</value-type>
 </event-definition>
...
</portlet-app></textarea>
			
	<p>Portlet can ask the portal to transmit an event by using the method setEvent of the interface stateAwareResponse.
	This interface is only available form ActionResponse and eventReponse. 
	In other words, you can only send event during action or event phases. 
	Thanks to PortletEventResultProcessor, 
	in a tapestry page you just need to return an object that implements the interface javax.portlet.Event.<p/>
	
	<p>First, you will need to request a server side action phase <p/>	    		    
	    
<textarea readonly="readonly"><t:eventlink t:event="publishEvent">Publish event</t:eventlink></textarea> 

	<p>and the related event handler could be something like</P>
		    
<textarea readonly="readonly">
public Event onPublishEvent()
{
    return new EventImpl(new QName("sampleEvent"), "the value");
}</textarea>

<p>To receive a portlet events, a portlet must first define in the portlet.xml the events that it can process.</p>

<textarea readonly="readonly">
public Event onPublishEvent()
...
<portlet>
  <portlet-name>EventReceiver</portlet-name>
  ...
  <supported-processing-event>
   <name>sampleEvent</name>
  </supported-processing-event>
  ....
 </portlet>
...</textarea>

	<p>To process the event, the portlet just has to declare an event handler for the related event</P>
		    
<textarea readonly="readonly">
public Object onSampleEvent(String event)
{
   //code to treat the event here
   return this; //ask for a refresh
}</textarea>

		
	<div data-role="collapsible" data-collapsed="true" data-theme="b" data-content-theme="d">
				
		<h3>More in this section</h3>
					
		<ul data-role="listview"  data-theme="c" data-dividertheme="d">
			<li data-role="list-divider">Features</li>
			<li ><a href="../../docs/features/Ajax.html">Ajax</a></li>
			<li ><a href="../../docs/features/clientid.html">ClientId</a></li>
			<li ><a href="../../docs/features/clientid.html">ClientId</a></li>
			<li data-theme="a"><a href="../../docs/features/portletCommunication.html">portletCommunication</a></li>	
		</ul>
	</div>	
		

	</div><!-- /content -->
	
	<div data-role="footer" class="footer-docs" data-theme="c">
		<p class="jqm-version"></p>
		<p>&copy; 2012 jQuery Foundation and other contributors</p>
	</div>	
	
	
</div><!-- /page -->

</body>
</html>
