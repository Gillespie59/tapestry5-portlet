<!DOCTYPE html> 
<html>
	<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1"> 
	<title>Tapestry5 Portlet - Peferences</title> 
	<link rel="stylesheet"  href="../../css/themes/default/jquery.mobile-1.2.0.css" /> 
	<link rel="stylesheet" href="../_assets/css/jqm-docs.css"/>

	<script src="../../js/jquery.js"></script>
	<script src="../../docs/_assets/js/jqm-docs.js"></script>
	<script src="../../js/jquery.mobile-1.2.0.js"></script>

</head> 
<body> 

<div data-role="page" class="type-interior">

	<div data-role="header" data-theme="f">
		<h1>Portlet Preferences</h1>
		<a href="../../" data-icon="home" data-iconpos="notext" data-direction="reverse">Home</a>
		<a href="../nav.html" data-icon="search" data-iconpos="notext" data-rel="dialog" data-transition="fade">Search</a>
	</div><!-- /header -->

	<div data-role="content">
		
	<h2>How to create EDIT pages ?</h2>
		
	<p>To edit the preferences of a portlet you will have to create a dedicated page in your 
	application and manipulate the PortletPreferences API to changes and store value. </p>

	<p>Declare in "portlet.xml" that your portlet supports "Edit" mode, example</p> 
		
<textarea readonly="readonly">
<portlet-name>TapestryPortlet</portlet-name>
       <portlet-class>org.apache.tapestry5.portlet.ApplicationPortlet</portlet-class>
       <supports>
             <mime-type>text/html</mime-type>
             <portlet-mode>VIEW</portlet-mode>
             <portlet-mode>HELP</portlet-mode>
             <portlet-mode>EDIT</portlet-mode>
       </supports>
       ...
</textarea> 

	<p> Create a preferences page for your portlet. 
	The name of this page must be the name of the Portlet and the page must be located in a "preferences" sub package of your root package application. 
	In our case, it will be "preferences/TapestryPortlet.java" and "preferences/TapestryPortlet.tml". 
	You can also add the “Preferences” suffix to the page name. 
	Now the contribution is able to run the portlet in edit mode, 
	you have to manipulate the Preferences API and update the values with data coming from a form for example.<p/>
	
<textarea readonly="readonly">
@Inject
private PortletRequestGlobals globals;
 
@OnEvent(value = EventConstants.SUBMIT, component = "form")
public void submitForm() throws ReadOnlyException, ValidatorException, IOException {
       globals.getPortletRequest().getPreferences().setValue("MyPreference", preference);
       globals.getPortletRequest().getPreferences().store();
}
</textarea>

	<p>The code snippet above describes how you can inject PortletRequestGlobals in the page to update the portlet instance preferences and store the new values. 
	Remind that only the portlet instance will be affected by this code.<p/>
       
       
       <p>In your Portlet, in View Mode, you will able to retrieve the value of your preferences by using the same mechanism :<p/>
 		    
<textarea readonly="readonly">
@setupRender
public void setupRender() {
       String preference = globals.getPortletRequest().getPreferences().getValue("MyPreferences", "defaultValue");
       globals.getPortletRequest().getPreferences().store();
}</textarea>
			
		
	<div data-role="collapsible" data-collapsed="true" data-theme="b" data-content-theme="d">
				
		<h3>More in this section</h3>
					
		<ul data-role="listview"  data-theme="c" data-dividertheme="d">
			<li data-role="list-divider">Features</li>
			<li ><a href="../../docs/features/Ajax.html">Ajax</a></li>
			<li ><a href="../../docs/features/clientId.html">ClientId</a></li>
			<li ><a href="../../docs/features/portletCommunication.html">Portlet Communication</a></li>
			<li ><a href="../../docs/features/persist.html">Persist</a></li>
			<li data-theme="a"><a href="../../docs/features/preferences.html">preferences</a></li>	
		</ul>
	</div>	
		

	</div><!-- /content -->
	
	<div data-role="footer" class="footer-docs" data-theme="c">
		<p class="jqm-version"></p>
		<p>&copy; 2012 jQuery Foundation and other contributors</p>
	</div>	
	
	
</div><!-- /page -->

</body>
</html>
